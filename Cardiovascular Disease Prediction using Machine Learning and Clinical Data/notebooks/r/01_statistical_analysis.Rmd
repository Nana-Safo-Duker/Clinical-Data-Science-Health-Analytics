---
title: "Statistical Analysis: Descriptive, Inferential, and Exploratory"
author: "Cardiovascular Disease Analysis"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: true
    toc_float: true
    code_folding: show
    theme: flatly
    highlight: tango
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE, 
                      fig.width = 12, fig.height = 6)
```

## Introduction

This notebook contains comprehensive statistical analysis of the Cardiovascular Disease Dataset, including:
- Descriptive Statistics
- Inferential Statistics
- Exploratory Data Analysis
- Hypothesis Testing

## Load Libraries and Data

```{r load-libraries}
# Load necessary libraries
library(tidyverse)
library(ggplot2)
library(dplyr)
library(corrplot)
library(VIM)
library(psych)
library(Hmisc)
library(car)
library(vcd)
library(gridExtra)

# Set theme for plots
theme_set(theme_minimal() + theme(plot.title = element_text(size = 14, face = "bold"),
                                  plot.subtitle = element_text(size = 12)))

# Load the dataset
df <- read.csv("../../data/Cardiovascular_Disease_Dataset.csv", stringsAsFactors = FALSE)

cat("Dataset loaded successfully!\n")
cat("Shape:", nrow(df), "rows,", ncol(df), "columns\n")
cat("\nFirst few rows:\n")
head(df)
```

## 1. Descriptive Statistics

### 1.1 Dataset Information

```{r dataset-info}
cat(paste(rep("=", 80), collapse = ""), "\n")
cat("DATASET INFORMATION\n")
cat(paste(rep("=", 80), collapse = ""), "\n")
cat("\nTotal records:", nrow(df), "\n")
cat("Total features:", ncol(df), "\n")
cat("Missing values:", sum(is.na(df)), "\n")
cat("\nData types:\n")
str(df)
```

### 1.2 Descriptive Statistics - Numerical Variables

```{r numerical-stats}
cat(paste(rep("=", 80), collapse = ""), "\n")
cat("DESCRIPTIVE STATISTICS - NUMERICAL VARIABLES\n")
cat(paste(rep("=", 80), collapse = ""), "\n")

numerical_cols <- c("age", "restingBP", "serumcholestrol", "maxheartrate", "oldpeak")
summary(df[numerical_cols])

# Detailed statistics using psych package
cat("\nDetailed Statistics:\n")
describe(df[numerical_cols])
```

### 1.3 Descriptive Statistics - Categorical Variables

```{r categorical-stats}
cat(paste(rep("=", 80), collapse = ""), "\n")
cat("DESCRIPTIVE STATISTICS - CATEGORICAL VARIABLES\n")
cat(paste(rep("=", 80), collapse = ""), "\n")

categorical_cols <- c("gender", "chestpain", "fastingbloodsugar", "restingrelectro", 
                     "exerciseangia", "slope", "noofmajorvessels", "target")

for (col in categorical_cols) {
  if (col %in% names(df)) {
    cat("\n", toupper(col), ":\n")
    print(table(df[[col]]))
    cat("Mode:", names(sort(table(df[[col]]), decreasing = TRUE))[1], "\n")
    cat("Percentage distribution:\n")
    print(prop.table(table(df[[col]])) * 100)
  }
}
```

### 1.4 Measures of Central Tendency and Dispersion

```{r central-tendency}
cat(paste(rep("=", 80), collapse = ""), "\n")
cat("MEASURES OF CENTRAL TENDENCY AND DISPERSION\n")
cat(paste(rep("=", 80), collapse = ""), "\n")

for (col in numerical_cols) {
  if (col %in% names(df)) {
    cat("\n", toupper(col), ":\n")
    cat("  Mean:", mean(df[[col]], na.rm = TRUE), "\n")
    cat("  Median:", median(df[[col]], na.rm = TRUE), "\n")
    cat("  Mode:", names(sort(table(df[[col]]), decreasing = TRUE))[1], "\n")
    cat("  Range:", max(df[[col]], na.rm = TRUE) - min(df[[col]], na.rm = TRUE), "\n")
    cat("  Variance:", var(df[[col]], na.rm = TRUE), "\n")
    cat("  Standard Deviation:", sd(df[[col]], na.rm = TRUE), "\n")
    cat("  Coefficient of Variation:", (sd(df[[col]], na.rm = TRUE) / mean(df[[col]], na.rm = TRUE)) * 100, "%\n")
    cat("  IQR:", IQR(df[[col]], na.rm = TRUE), "\n")
    cat("  Skewness:", psych::skew(df[[col]], na.rm = TRUE), "\n")
    cat("  Kurtosis:", psych::kurtosi(df[[col]], na.rm = TRUE), "\n")
  }
}
```

## 2. Inferential Statistics

### 2.1 Normality Tests

```{r normality-tests}
cat(paste(rep("=", 80), collapse = ""), "\n")
cat("NORMALITY TESTS (Shapiro-Wilk Test)\n")
cat(paste(rep("=", 80), collapse = ""), "\n")

for (col in numerical_cols) {
  if (col %in% names(df)) {
    # Take a sample if dataset is large (Shapiro-Wilk works best on samples < 5000)
    sample_size <- min(5000, nrow(df))
    sample_data <- sample(df[[col]], sample_size, replace = FALSE)
    
    test_result <- shapiro.test(sample_data)
    is_normal <- ifelse(test_result$p.value > 0.05, "Yes", "No")
    
    cat("\n", toupper(col), ":\n")
    cat("  Statistic:", test_result$statistic, "\n")
    cat("  p-value:", test_result$p.value, "\n")
    cat("  Normally distributed:", is_normal, "(α = 0.05)\n")
  }
}
```

### 2.2 T-test: Comparing Means Between Groups

```{r t-test}
cat(paste(rep("=", 80), collapse = ""), "\n")
cat("T-TEST: COMPARING MEANS BETWEEN DISEASE AND NO DISEASE GROUPS\n")
cat(paste(rep("=", 80), collapse = ""), "\n")

disease_0 <- df[df$target == 0, ]
disease_1 <- df[df$target == 1, ]

for (col in numerical_cols) {
  if (col %in% names(df)) {
    group_0 <- disease_0[[col]]
    group_1 <- disease_1[[col]]
    
    if (length(group_0) > 0 && length(group_1) > 0) {
      test_result <- t.test(group_0, group_1)
      
      cat("\n", toupper(col), ":\n")
      cat("  Mean (No Disease):", mean(group_0, na.rm = TRUE), "\n")
      cat("  Mean (Disease):", mean(group_1, na.rm = TRUE), "\n")
      cat("  t-statistic:", test_result$statistic, "\n")
      cat("  p-value:", test_result$p.value, "\n")
      cat("  Significant difference:", ifelse(test_result$p.value < 0.05, "Yes", "No"), "(α = 0.05)\n")
    }
  }
}
```

### 2.3 Chi-square Test for Categorical Variables

```{r chi-square}
cat(paste(rep("=", 80), collapse = ""), "\n")
cat("CHI-SQUARE TEST: ASSOCIATION BETWEEN CATEGORICAL VARIABLES AND TARGET\n")
cat(paste(rep("=", 80), collapse = ""), "\n")

categorical_vars <- c("gender", "chestpain", "fastingbloodsugar", "restingrelectro", 
                     "exerciseangia", "slope", "noofmajorvessels")

for (var in categorical_vars) {
  if (var %in% names(df) && var != "target") {
    contingency_table <- table(df[[var]], df$target)
    test_result <- chisq.test(contingency_table)
    
    cat("\n", toupper(var), "vs TARGET:\n")
    cat("  Chi-square statistic:", test_result$statistic, "\n")
    cat("  p-value:", test_result$p.value, "\n")
    cat("  Degrees of freedom:", test_result$parameter, "\n")
    cat("  Significant association:", ifelse(test_result$p.value < 0.05, "Yes", "No"), "(α = 0.05)\n")
    cat("\n  Contingency Table:\n")
    print(contingency_table)
  }
}
```

### 2.4 ANOVA: Comparing Means Across Multiple Groups

```{r anova}
cat(paste(rep("=", 80), collapse = ""), "\n")
cat("ANOVA: COMPARING MEANS ACROSS CHEST PAIN TYPES\n")
cat(paste(rep("=", 80), collapse = ""), "\n")

# Perform ANOVA for age across chest pain types
anova_result <- aov(age ~ as.factor(chestpain), data = df)
summary(anova_result)

cat("\nMean age by chest pain type:\n")
print(aggregate(age ~ chestpain, data = df, FUN = mean))
```

## 3. Exploratory Data Analysis

### 3.1 Distribution of Target Variable

```{r target-distribution}
target_counts <- table(df$target)
target_percent <- prop.table(target_counts) * 100

cat("Target Distribution:\n")
cat("  No Disease (0):", target_counts["0"], "(", round(target_percent["0"], 2), "%)\n")
cat("  Disease (1):", target_counts["1"], "(", round(target_percent["1"], 2), "%)\n")

# Visualize
ggplot(df, aes(x = factor(target), fill = factor(target))) +
  geom_bar(alpha = 0.8) +
  scale_fill_manual(values = c("skyblue", "coral"), labels = c("No Disease", "Disease")) +
  labs(title = "Distribution of Target Variable",
       x = "Target",
       y = "Count",
       fill = "Target") +
  theme(legend.position = "right") +
  geom_text(stat = "count", aes(label = ..count..), vjust = -0.5, size = 5)
```

### 3.2 Distribution of Numerical Variables

```{r numerical-distributions}
# Create histogram plots for numerical variables
plots <- list()
for (col in numerical_cols) {
  if (col %in% names(df)) {
    p <- ggplot(df, aes_string(x = col)) +
      geom_histogram(bins = 30, fill = "steelblue", alpha = 0.7, color = "black") +
      geom_vline(aes_string(xintercept = mean(df[[col]], na.rm = TRUE)), 
                 color = "red", linetype = "dashed", size = 1) +
      geom_vline(aes_string(xintercept = median(df[[col]], na.rm = TRUE)), 
                 color = "green", linetype = "dashed", size = 1) +
      labs(title = paste("Distribution of", col),
           x = col,
           y = "Frequency") +
      theme_minimal()
    plots[[col]] <- p
  }
}

# Display plots
do.call(grid.arrange, c(plots, ncol = 2))
```

### 3.3 Box Plots for Numerical Variables by Target

```{r boxplots}
# Create box plots
plots <- list()
for (col in numerical_cols) {
  if (col %in% names(df)) {
    p <- ggplot(df, aes_string(x = "factor(target)", y = col, fill = "factor(target)")) +
      geom_boxplot(alpha = 0.7) +
      scale_fill_manual(values = c("skyblue", "coral"), labels = c("No Disease", "Disease")) +
      labs(title = paste(col, "by Target"),
           x = "Target",
           y = col,
           fill = "Target") +
      theme_minimal() +
      theme(legend.position = "none")
    plots[[col]] <- p
  }
}

do.call(grid.arrange, c(plots, ncol = 2))
```

### 3.4 Correlation Matrix

```{r correlation}
# Correlation matrix
correlation_matrix <- cor(df[numerical_cols], use = "complete.obs")

# Visualize correlation matrix
corrplot(correlation_matrix, method = "color", type = "upper", 
         order = "hclust", tl.cex = 0.8, tl.col = "black",
         addCoef.col = "black", number.cex = 0.7)

# Print correlation matrix
cat("\nCorrelation Matrix:\n")
print(round(correlation_matrix, 3))
```

### 3.5 Summary Statistics by Target

```{r summary-by-target}
cat(paste(rep("=", 80), collapse = ""), "\n")
cat("SUMMARY STATISTICS BY TARGET VARIABLE\n")
cat(paste(rep("=", 80), collapse = ""), "\n")

cat("\nNO DISEASE (Target = 0):\n")
print(summary(df[df$target == 0, numerical_cols]))

cat("\n\nDISEASE (Target = 1):\n")
print(summary(df[df$target == 1, numerical_cols]))
```

## 4. Confidence Intervals

### 4.1 95% Confidence Intervals for Means

```{r confidence-intervals}
cat(paste(rep("=", 80), collapse = ""), "\n")
cat("95% CONFIDENCE INTERVALS FOR MEANS\n")
cat(paste(rep("=", 80), collapse = ""), "\n")

confidence_level <- 0.95
alpha <- 1 - confidence_level

for (col in numerical_cols) {
  if (col %in% names(df)) {
    data <- df[[col]][!is.na(df[[col]])]
    n <- length(data)
    mean_val <- mean(data)
    std_err <- sd(data) / sqrt(n)
    t_critical <- qt((1 + confidence_level) / 2, n - 1)
    margin_error <- std_err * t_critical
    
    ci_lower <- mean_val - margin_error
    ci_upper <- mean_val + margin_error
    
    cat("\n", toupper(col), ":\n")
    cat("  Mean:", mean_val, "\n")
    cat("  95% CI: [", ci_lower, ",", ci_upper, "]\n")
  }
}
```

## 5. Key Findings and Conclusions

### Descriptive Statistics:
- Dataset contains `r nrow(df)` records with `r ncol(df)` features
- Target variable distribution needs to be checked
- Numerical variables show various distributions

### Inferential Statistics:
- T-tests reveal significant differences between disease and no-disease groups for several variables
- Chi-square tests show associations between categorical variables and target
- ANOVA tests reveal differences across groups

### Exploratory Findings:
- Correlation analysis reveals relationships between variables
- Distribution plots show data characteristics
- Box plots reveal outliers and group differences
